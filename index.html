<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç‰§ã€œä¸‹é–¢ ãƒ‰ãƒ©ã‚¤ãƒ–ã—ãŠã‚Š</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --main: #5d9cec; --sub: #48cfad; --warn: #fc6e51; --bg: #f0f2f5; }
        * { box-sizing: border-box; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); margin: 0; padding: 10px; color: #333; font-size: 14px; }
        
        .box { background: white; padding: 12px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .total-price { color: var(--warn); font-size: 1.4rem; font-weight: bold; }

        input[type="text"], input[type="number"], input[type="time"], input[type="date"] {
            border: 1px solid #ddd; border-radius: 5px; padding: 6px; font-size: 14px; min-width: 0;
        }

        /* è²»ç”¨æ˜ç´°ã®æœ€é©åŒ– */
        .cost-row { display: flex; gap: 4px; margin-bottom: 6px; align-items: center; width: 100%; }
        .cost-row input[type="text"] { flex: 2; }
        .cost-row input[type="number"] { flex: 1.2; text-align: right; }
        .row-del { color: white; background: #ccc; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }

        .day-label { background: var(--main); color: white; padding: 5px 12px; border-radius: 15px; display: inline-block; margin: 10px 0; font-weight: bold; }
        .card { background: white; border-radius: 10px; margin-bottom: 8px; border-left: 5px solid var(--main); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .card-summary { display: flex; align-items: center; padding: 10px; }
        .handle { color: #ddd; padding-right: 8px; font-size: 1.4rem; touch-action: none; }
        .t-in { width: 85px; }
        .p-in-top { flex-grow: 1; border: none !important; font-weight: bold; margin-left: 5px; font-size: 0.95rem; background: transparent; }
        .toggle-btn { color: var(--main); border: 1px solid var(--main); border-radius: 5px; padding: 4px 8px; font-size: 11px; white-space: nowrap; }

        .card-detail { display: none; padding: 12px; background: #fafafa; border-top: 1px solid #eee; }
        .card-detail.active { display: block; }

        .info-box { background: #eef3f9; padding: 8px; border-radius: 8px; font-size: 11px; margin-bottom: 10px; line-height: 1.4; }
        .map-link { display: inline-block; background: #4285F4; color: white; padding: 6px 12px; border-radius: 5px; text-decoration: none; font-size: 11px; margin-bottom: 10px; font-weight: bold; }

        .btn { border: none; border-radius: 10px; padding: 12px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-save { background: var(--main); color: white; margin-top: 10px; }
        .btn-add { background: var(--sub); color: white; margin-top: 15px; }
        .btn-add-cost { background: #eee; color: #666; font-size: 12px; padding: 6px; width: auto; margin: 5px 0; border-radius: 5px; display: inline-block; }

        .hist-item { display: flex; justify-content: space-between; background: #e9ecef; padding: 8px; border-radius: 6px; margin-bottom: 5px; font-size: 11px; align-items: center; }
        .btn-restore { background: #666; color: white; padding: 3px 10px; border-radius: 4px; border: none; }
    </style>
</head>
<body>

<div class="box">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <span style="font-weight:bold">ğŸ’° æ—…ã®åˆè¨ˆ:</span>
        <span class="total-price"><span id="total-val">0</span> å††</span>
    </div>
    
    <div style="margin-top:10px; border-top: 1px solid #eee; padding-top:10px">
        <div style="font-size:11px; color:#666; margin-bottom:5px">â–¼ åˆæœŸè²»ç”¨ï¼ˆé«˜é€Ÿãƒ»ç‡ƒæ–™ãƒ»å®¿æ³Šï¼‰</div>
        <div id="base-costs">
            <div class="cost-row"><input type="text" value="é«˜é€Ÿ(å°ç‰§-ä¸‹é–¢ æ·±å¤œå‰²)"><input type="number" class="price-input" value="10290" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
            <div class="cost-row"><input type="text" value="ã‚¬ã‚½ãƒªãƒ³ä»£(ç‰‡é“ç›®å®‰)"><input type="number" class="price-input" value="7000" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
            <div class="cost-row"><input type="text" value="é§è»Šå ´ä»£(åºƒå³¶ãƒ»ä¸‹é–¢)"><input type="number" class="price-input" value="1000" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
        </div>
        <button class="btn-add-cost" onclick="addCostRow('base-costs')">ï¼‹ é …ç›®ã‚’è¿½åŠ </button>
    </div>
    <button class="btn btn-save" onclick="saveAll()">ğŸ’¾ å¤‰æ›´ã‚’ä¿å­˜ã—ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
</div>

<div id="main-list">
    <div class="day-label"><input type="date" value="2025-12-29" style="border:none; background:transparent; color:white; font-weight:bold"></div>
    
    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="01:30">
            <input class="p-in-top" value="å°ç‰§ å‡ºç™º">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">4æ™‚ã¾ã§ã«é«˜é€Ÿé€šéã§æ·±å¤œå‰²å¼•30%OFFï¼å®‰å…¨é‹è»¢ã§ğŸ§½</div>
            <div class="cost-area"></div>
            <button class="btn-add-cost" onclick="addCostRow(this)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
        </div>
    </div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="03:30">
            <input class="p-in-top" value="ã€äº¬éƒ½ã€‘å¤§æ´¥SAï¼ˆä¸‹ã‚Šï¼‰">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <a href="https://www.w-holdings.co.jp/sapa/02080/" class="map-link" target="_blank">ğŸ”— å…¬å¼ã‚µã‚¤ãƒˆ</a>
            <div class="info-box">ä½æ‰€ï¼šæ»‹è³€çœŒå¤§æ´¥å¸‚æœæ—¥ãŒä¸˜2-8-1<br>æ¥½ã—ã¿ï¼šçµç¶æ¹–å±•æœ›ãƒ‡ãƒƒã‚­ã€äº¬é¢¨æ¼¬ç‰©ã€ç”Ÿå…«ã¤æ©‹</div>
            <div class="cost-row"><input type="text" value="æœé£Ÿãƒ»åœŸç”£"><input type="number" class="price-input" value="1500" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
            <button class="btn-add-cost" onclick="addCostRow(this)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
        </div>
    </div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="05:30">
            <input class="p-in-top" value="ã€å¤§é˜ªã€‘å¹ç”°SAï¼ˆä¸‹ã‚Šï¼‰">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <a href="https://www.w-holdings.co.jp/sapa/02120/" class="map-link" target="_blank">ğŸ”— å…¬å¼ã‚µã‚¤ãƒˆ</a>
            <div class="info-box">æ¥½ã—ã¿ï¼šãŸã“ç„¼ããƒ»è±šã¾ã‚“ã€‚å¤§é˜ªé™å®šã‚¹ãƒãƒ³ã‚¸ãƒœãƒ–æœç´¢ï¼</div>
            <div class="cost-area"></div>
            <button class="btn-add-cost" onclick="addCostRow(this)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
        </div>
    </div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="10:30">
            <input class="p-in-top" value="ã€åºƒå³¶ã€‘åŸçˆ†ãƒ‰ãƒ¼ãƒ ">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ä¸–ç•Œéºç”£æ•£ç­–ã€‚é§è»Šå ´ã¯ä¸­å³¶ç”ºé§è»Šå ´ãŒä¾¿åˆ©ã€‚<br>ãŠæ˜¼ã¯ãŠå¥½ã¿ç„¼ãã‚’ï¼</div>
            <div class="cost-area"></div>
            <button class="btn-add-cost" onclick="addCostRow(this)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
        </div>
    </div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="15:00">
            <input class="p-in-top" value="ä¸‹é–¢ãƒ›ãƒ†ãƒ« ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼å¤œã®å”æˆ¸å¸‚å ´å‘¨è¾ºã¸ã€‚</div>
        </div>
    </div>

    <div class="day-label"><input type="date" value="2025-12-30" style="border:none; background:transparent; color:white; font-weight:bold"></div>
    
    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="09:00">
            <input class="p-in-top" value="ä¸‹é–¢ ç¥ç¤¾å·¡ã‚Šï¼ˆäº€å±±ãƒ»èµ¤é–“ï¼‰">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">äº€å±±å…«å¹¡å®®ï¼šãƒ•ã‚°ã®åƒ<br>èµ¤é–“ç¥å®®ï¼šç«œå®®é–€ãŒç‰¹å¾´ã€‚å¾¡æœ±å°å—ä»˜ã¯9:00ã€œ</div>
            <div class="cost-row"><input type="text" value="å¾¡æœ±å°ä»£"><input type="number" class="price-input" value="1000" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
            <button class="btn-add-cost" onclick="addCostRow(this)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
        </div>
    </div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="10:30">
            <input class="p-in-top" value="è§’å³¶å¤§æ©‹ è¦³å…‰">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚°ãƒªãƒ¼ãƒ³ã®æµ·ã‚’æ¸¡ã‚‹çµ¶æ™¯ãƒ‰ãƒ©ã‚¤ãƒ–ï¼</div>
        </div>
    </div>
</div>

<button class="btn btn-add" onclick="addNewCard()">ï¼‹ äºˆå®šã‚’è‡ªç”±ã«è¿½åŠ </button>

<div class="box" style="margin-top:20px; background:#f8f9fa">
    <div style="font-weight:bold; font-size:12px; margin-bottom:8px">ğŸ•’ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å±¥æ­´ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§å¾©å…ƒï¼‰</div>
    <div id="hist-list"></div>
</div>

<script>
    Sortable.create(document.getElementById('main-list'), {
        handle: '.handle', animation: 150, delay: 400, delayOnTouchOnly: true
    });

    function toggleDetail(btn) {
        btn.parentElement.nextElementSibling.classList.toggle('active');
        btn.innerText = btn.innerText === 'è©³ç´°' ? 'é–‰ã˜ã‚‹' : 'è©³ç´°';
    }

    function calc() {
        let t = 0;
        document.querySelectorAll('.price-input').forEach(i => t += (parseInt(i.value) || 0));
        document.getElementById('total-val').innerText = t.toLocaleString();
    }

    function delRow(btn) { btn.parentElement.remove(); calc(); }

    function addCostRow(target) {
        const parent = typeof target === 'string' ? document.getElementById(target) : (target.classList.contains('btn-add-cost') ? target.previousElementSibling : target);
        const div = document.createElement('div');
        div.className = 'cost-row';
        div.innerHTML = `<input type="text" placeholder="é …ç›®å"><input type="number" class="price-input" value="0" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button>`;
        parent.appendChild(div);
    }

    function addNewCard() {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="card-summary">
                <span class="handle">â˜°</span>
                <input type="time" class="t-in" value="12:00">
                <input class="p-in-top" placeholder="æ–°ã—ã„äºˆå®š">
                <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
            </div>
            <div class="card-detail">
                <div class="cost-area"></div>
                <button class="btn-add-cost" onclick="addCostRow(this.previousElementSibling)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
                <button class="btn" style="background:#eee; color:#999; font-size:11px; padding:5px; margin-top:10px" onclick="this.parentElement.parentElement.remove();calc()">äºˆå®šã‚’å‰Šé™¤</button>
            </div>`;
        document.getElementById('main-list').appendChild(div);
    }

    function saveAll() {
        const data = {
            baseHtml: document.getElementById('base-costs').innerHTML,
            listHtml: document.getElementById('main-list').innerHTML,
            time: new Date().toLocaleString()
        };
        let h = JSON.parse(localStorage.getItem('shiori_backup') || '[]');
        h.unshift(data);
        localStorage.setItem('shiori_backup', JSON.stringify(h.slice(0, 10)));
        renderHist();
        alert('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã—ãŸï¼');
    }

    function renderHist() {
        const h = JSON.parse(localStorage.getItem('shiori_backup') || '[]');
        document.getElementById('hist-list').innerHTML = h.map((d, i) => `
            <div class="hist-item">
                <span>ä¿å­˜: ${d.time}</span>
                <button class="btn-restore" onclick="restore(${i})">å¾©å…ƒ</button>
            </div>`).join('');
    }

    function restore(i) {
        const h = JSON.parse(localStorage.getItem('shiori_backup') || '[]');
        document.getElementById('base-costs').innerHTML = h[i].baseHtml;
        document.getElementById('main-list').innerHTML = h[i].listHtml;
        calc();
        alert('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸï¼');
    }

    window.onload = () => {
        const h = JSON.parse(localStorage.getItem('shiori_backup') || '[]');
        if (h.length > 0) restore(0); else calc();
        renderHist();
    };
</script>
</body>
</html>
