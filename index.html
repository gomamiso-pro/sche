<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç‰§ã€œä¸‹é–¢ã—ãŠã‚Š</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --main: #5d9cec; --sub: #48cfad; --warn: #fc6e51; --bg: #f8f9fa; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; font-size: 14px; }
        .container { max-width: 100%; }
        
        /* è²»ç”¨è¡¨ç¤º */
        .box { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .flex-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        input[type="number"], input[type="text"] { border: 1px solid #ddd; border-radius: 4px; padding: 6px; font-size: 14px; }
        
        .total-price { color: var(--warn); font-size: 1.4rem; font-weight: bold; }

        /* ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« */
        .day-tag { background: var(--main); color: white; padding: 4px 12px; border-radius: 15px; font-size: 12px; margin: 15px 0 8px; display: inline-block; }
        .card { 
            background: white; margin-bottom: 6px; padding: 10px 8px; border-radius: 8px;
            display: flex; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid var(--main); touch-action: none;
        }
        .handle { color: #ccc; padding: 0 8px; font-size: 18px; cursor: move; }
        .t-in { width: 50px; border: none; font-weight: bold; color: var(--main); background: transparent; }
        .c-in { flex-grow: 1; border: none; margin: 0 4px; background: transparent; min-width: 0; }
        .p-in { width: 55px; text-align: right; border: 1px solid #eee; border-radius: 4px; }

        /* ãƒœã‚¿ãƒ³ */
        .btn { border: none; border-radius: 8px; padding: 12px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 5px; }
        .btn-save { background: var(--main); color: white; }
        .btn-add { background: var(--sub); color: white; margin-top: 15px; }
        .btn-del { background: #f0f0f0; color: #999; padding: 4px 8px; font-size: 12px; width: auto; margin-left: 4px; }

        /* å±¥æ­´è¡¨ç¤º */
        .history-box { margin-top: 25px; padding: 10px; border-top: 1px solid #ddd; }
        .hist-item { display: flex; justify-content: space-between; background: #eee; padding: 8px; border-radius: 6px; margin-bottom: 4px; font-size: 11px; }
        .btn-restore { background: #666; color: white; padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div class="box">
        <div class="flex-row">
            <span>åˆæœŸè²»ç”¨(é«˜é€Ÿãƒ»ç‡ƒæ–™ãƒ»å®¿):</span>
            <input type="number" id="base-cost" value="18000" oninput="calc()" style="width:90px">
        </div>
        <div class="flex-row" style="justify-content: flex-end;">
            <span>åˆè¨ˆ: <span id="total" class="total-price">0</span> å††</span>
        </div>
        <button class="btn btn-save" onclick="saveData()">ğŸ’¾ å¤‰æ›´ã‚’ä¿å­˜ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰</button>
    </div>

    <div id="list">
        <div class="day-tag">12æœˆ29æ—¥ï¼šç§»å‹•ã¨è¦³å…‰</div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="01:30"><input class="c-in" value="å°ç‰§ å‡ºç™º"><input type="number" class="p-in" value="0" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="03:30"><input class="c-in" value="ã€äº¬éƒ½ã€‘å¤§æ´¥SA"><input type="number" class="p-in" value="1000" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="05:30"><input class="c-in" value="ã€å¤§é˜ªã€‘å¹ç”°SA(ã‚¹ãƒãƒ³ã‚¸ãƒœãƒ–)"><input type="number" class="p-in" value="1000" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="08:00"><input class="c-in" value="ã€å²¡å±±ã€‘å‰å‚™SA(ãã³ã ã‚“ã”)"><input type="number" class="p-in" value="1000" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="10:30"><input class="c-in" value="ã€åºƒå³¶ã€‘åŸçˆ†ãƒ‰ãƒ¼ãƒ "><input type="number" class="p-in" value="500" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="13:30"><input class="c-in" value="ã€åºƒå³¶ã€‘å®®å³¶SA(ãŠå¥½ã¿ç„¼ã)"><input type="number" class="p-in" value="1500" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="15:00"><input class="c-in" value="ä¸‹é–¢ãƒ›ãƒ†ãƒ«ç€"><input type="number" class="p-in" value="0" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        
        <div class="day-tag">12æœˆ30æ—¥ï¼šä¸‹é–¢ãƒ»è§’å³¶</div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="09:00"><input class="c-in" value="äº€å±±å…«å¹¡ãƒ»èµ¤é–“ç¥å®®(å¾¡æœ±å°)"><input type="number" class="p-in" value="1000" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="10:30"><input class="c-in" value="è§’å³¶å¤§æ©‹"><input type="number" class="p-in" value="0" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
        <div class="card"><span class="handle">â˜°</span><input class="t-in" value="13:00"><input class="c-in" value="ä¸‹é–¢ å‡ºç™º"><input type="number" class="p-in" value="0" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button></div>
    </div>

    <button class="btn btn-add" onclick="addItem()">ï¼‹ äºˆå®šã‚’è¿½åŠ </button>

    <div class="history-box">
        <div style="font-weight:bold; margin-bottom:8px">ğŸ•’ ä¿å­˜å±¥æ­´ï¼ˆã“ã“ã‹ã‚‰æˆ»ã›ã¾ã™ï¼‰</div>
        <div id="h-list"></div>
    </div>
</div>

<script>
    const sortable = Sortable.create(document.getElementById('list'), {
        handle: '.handle', animation: 150, delay: 400, delayOnTouchOnly: true
    });

    function calc() {
        let t = parseInt(document.getElementById('base-cost').value) || 0;
        document.querySelectorAll('.p-in').forEach(i => t += (parseInt(i.value) || 0));
        document.getElementById('total').innerText = t.toLocaleString();
    }

    function del(btn) { btn.parentElement.remove(); calc(); }

    function addItem() {
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = `<span class="handle">â˜°</span><input class="t-in" value="12:00"><input class="c-in" value="æ–°ã—ã„äºˆå®š"><input type="number" class="p-in" value="0" oninput="calc()"><button class="btn-del" onclick="del(this)">Ã—</button>`;
        document.getElementById('list').appendChild(d);
        calc();
    }

    function saveData() {
        const data = {
            base: document.getElementById('base-cost').value,
            html: document.getElementById('list').innerHTML,
            time: new Date().toLocaleTimeString()
        };
        let h = JSON.parse(localStorage.getItem('trip_save') || '[]');
        h.unshift(data);
        localStorage.setItem('trip_save', JSON.stringify(h.slice(0,5)));
        renderH();
        alert('ä¿å­˜ã—ã¾ã—ãŸï¼');
    }

    function renderH() {
        const h = JSON.parse(localStorage.getItem('trip_save') || '[]');
        document.getElementById('h-list').innerHTML = h.map((d, i) => `
            <div class="hist-item">
                <span>ä¿å­˜æ¸ˆã¿ (${d.time})</span>
                <button class="btn-restore" onclick="restore(${i})">æˆ»ã™</button>
            </div>
        `).join('');
    }

    function restore(i) {
        const h = JSON.parse(localStorage.getItem('trip_save') || '[]');
        document.getElementById('base-cost').value = h[i].base;
        document.getElementById('list').innerHTML = h[i].html;
        calc();
        alert('å¾©å…ƒã—ã¾ã—ãŸï¼');
    }

    window.onload = () => { calc(); renderH(); };
</script>
</body>
</html>
