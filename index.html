<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…ã®ã—ãŠã‚Š - è¨˜éŒ²æ©Ÿèƒ½ä»˜</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --primary: #5d9cec;
            --secondary: #48cfad;
            --accent: #fc6e51;
            --bg: #f0f2f5;
            --card-bg: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 15px;
            color: #333;
            -webkit-user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’é˜²ã„ã§æ“ä½œæ€§å‘ä¸Š */
        }

        .container { max-width: 100%; margin: 0 auto; }
        
        h1 { font-size: 1.4rem; text-align: center; color: var(--primary); margin-bottom: 15px; }

        .box {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        .cost-row { display: flex; align-items: center; justify-content: space-between; font-size: 0.9rem; }
        input[type="number"], input[type="text"] {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            font-size: 1rem;
        }

        .day-header {
            font-weight: bold;
            color: white;
            background: var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .card {
            background: white;
            margin-bottom: 10px;
            padding: 12px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            touch-action: none; /* ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ç«¶åˆã—ãªã„ã‚ˆã†ã« */
            border-left: 6px solid var(--primary);
        }

        .handle { color: #ccc; margin-right: 10px; font-size: 1.2rem; }
        .time-input { width: 60px; border: none; font-weight: bold; color: var(--primary); }
        .content-input { flex-grow: 1; border: none; margin: 0 5px; font-size: 0.95rem; }
        .cost-input { width: 60px; text-align: right; }

        .btn {
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-add { background: var(--secondary); color: white; width: 100%; margin-bottom: 20px; }
        .btn-save { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .btn-del { background: #eee; color: #666; margin-left: 5px; padding: 5px 10px; }

        /* å±¥æ­´ã‚¨ãƒªã‚¢ */
        .history-section { margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 15px; }
        .history-item {
            background: #e9ecef;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
        }
        .btn-restore { background: #6c757d; color: white; padding: 2px 8px; font-size: 0.7rem; }

        .total-val { font-size: 1.3rem; color: var(--accent); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸš— æ—…ã®ã—ãŠã‚Š - ã¨ã‚‚æ§˜ç”¨ ğŸ§½</h1>

    <div class="box">
        <div class="cost-row">
            <span>åˆæœŸè²»ç”¨:</span>
            <input type="number" id="base-cost" value="25000" oninput="calc()" style="width: 100px;"> å††
        </div>
        <div style="text-align: right; margin-top: 10px;">
            åˆè¨ˆ: <span id="total-display" class="total-val">0</span> å††
        </div>
        <button class="btn btn-save" onclick="saveData()">ğŸ’¾ ç¾åœ¨ã®ç§»å‹•ã‚’ä¿å­˜ã™ã‚‹</button>
    </div>

    <div id="schedule-container">
        <div class="day-header">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆé•·æŠ¼ã—ã§ç§»å‹•ï¼‰</div>
        <div id="main-list">
            <div class="card"><span class="handle">â˜°</span><input class="time-input" value="01:30"><input class="content-input" value="å°ç‰§ å‡ºç™º"><input type="number" class="cost-input" value="0" oninput="calc()"><button class="btn-del" onclick="this.parentElement.remove();calc()">Ã—</button></div>
            <div class="card"><span class="handle">â˜°</span><input class="time-input" value="09:00"><input class="content-input" value="å‰å‚™SA (ã‚¹ãƒãƒ³ã‚¸ãƒœãƒ–)"><input type="number" class="cost-input" value="1000" oninput="calc()"><button class="btn-del" onclick="this.parentElement.remove();calc()">Ã—</button></div>
            <div class="card"><span class="handle">â˜°</span><input class="time-input" value="15:00"><input class="content-input" value="ä¸‹é–¢ãƒ›ãƒ†ãƒ«ç€"><input type="number" class="cost-input" value="0" oninput="calc()"><button class="btn-del" onclick="this.parentElement.remove();calc()">Ã—</button></div>
        </div>
        <button class="btn btn-add" onclick="addNewItem()">ï¼‹ äºˆå®šã‚’è¿½åŠ </button>
    </div>

    <div class="history-section">
        <div style="font-weight: bold; margin-bottom: 10px;">ğŸ•’ ä¿å­˜ã—ãŸè¨˜éŒ²</div>
        <div id="history-list"></div>
    </div>
</div>

<script>
    // é•·æŠ¼ã—(500ms)ã§ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
    const el = document.getElementById('main-list');
    Sortable.create(el, {
        handle: '.handle',
        animation: 150,
        delay: 500,
        delayOnTouchOnly: true,
        onEnd: () => { console.log('ä¸¦ã³æ›¿ãˆå®Œäº†'); }
    });

    function calc() {
        let total = parseInt(document.getElementById('base-cost').value) || 0;
        document.querySelectorAll('.cost-input').forEach(i => total += (parseInt(i.value) || 0));
        document.getElementById('total-display').innerText = total.toLocaleString();
    }

    function addNewItem() {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<span class="handle">â˜°</span><input class="time-input" value="12:00"><input class="content-input" value="æ–°ã—ã„äºˆå®š"><input type="number" class="cost-input" value="0" oninput="calc()"><button class="btn-del" onclick="this.parentElement.remove();calc()">Ã—</button>`;
        document.getElementById('main-list').appendChild(div);
        calc();
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    function saveData() {
        const items = [];
        document.querySelectorAll('.card').forEach(card => {
            items.push({
                time: card.querySelector('.time-input').value,
                content: card.querySelector('.content-input').value,
                cost: card.querySelector('.cost-input').value
            });
        });
        const data = {
            base: document.getElementById('base-cost').value,
            items: items,
            date: new Date().toLocaleString()
        };
        
        let history = JSON.parse(localStorage.getItem('travel_history') || '[]');
        history.unshift(data);
        if(history.length > 5) history.pop(); // æœ€å¤§5ä»¶ä¿æŒ
        localStorage.setItem('travel_history', JSON.stringify(history));
        alert('ä¿å­˜ã—ã¾ã—ãŸï¼');
        renderHistory();
    }

    // å±¥æ­´ã‚’è¡¨ç¤º
    function renderHistory() {
        const historyList = document.getElementById('history-list');
        const history = JSON.parse(localStorage.getItem('travel_history') || '[]');
        historyList.innerHTML = history.map((h, index) => `
            <div class="history-item">
                <span>${h.date}</span>
                <button class="btn-restore" onclick="restore(${index})">æˆ»ã™</button>
            </div>
        `).join('');
    }

    // è¨˜éŒ²ã‚’å¾©å…ƒ
    function restore(index) {
        const history = JSON.parse(localStorage.getItem('travel_history') || '[]');
        const data = history[index];
        document.getElementById('base-cost').value = data.base;
        const list = document.getElementById('main-list');
        list.innerHTML = '';
        data.items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<span class="handle">â˜°</span><input class="time-input" value="${item.time}"><input class="content-input" value="${item.content}"><input type="number" class="cost-input" value="${item.cost}" oninput="calc()"><button class="btn-del" onclick="this.parentElement.remove();calc()">Ã—</button>`;
            list.appendChild(div);
        });
        calc();
        alert('è¨˜éŒ²ã‚’å¾©å…ƒã—ã¾ã—ãŸã€‚');
    }

    window.onload = () => { calc(); renderHistory(); };
</script>
</body>
</html>
