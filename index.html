<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—…ã®ã—ãŠã‚Šæ±ºå®šç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --main: #5d9cec; --sub: #48cfad; --warn: #fc6e51; --bg: #f0f2f5; }
        * { box-sizing: border-box; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); margin: 0; padding: 10px; color: #333; font-size: 14px; }
        
        .box { background: white; padding: 12px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .total-price { color: var(--warn); font-size: 1.4rem; font-weight: bold; }

        /* å…¥åŠ›æ¬„ã®å¹…èª¿æ•´ */
        input[type="text"], input[type="number"], input[type="time"], input[type="date"] {
            border: 1px solid #ddd; border-radius: 5px; padding: 6px; font-size: 14px; min-width: 0;
        }

        /* è²»ç”¨æ˜ç´°ã®æ¨ªå¹…æœ€é©åŒ– */
        .cost-row { display: flex; gap: 4px; margin-bottom: 6px; align-items: center; width: 100%; }
        .cost-row input[type="text"] { flex: 2; }
        .cost-row input[type="number"] { flex: 1.2; text-align: right; }
        .row-del { color: white; background: #ccc; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; flex-shrink: 0; }

        /* ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ */
        .day-label { background: var(--main); color: white; padding: 5px 12px; border-radius: 15px; display: inline-block; margin: 10px 0; font-weight: bold; }
        .card { background: white; border-radius: 10px; margin-bottom: 8px; border-left: 5px solid var(--main); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .card-summary { display: flex; align-items: center; padding: 10px; }
        .handle { color: #ddd; padding-right: 8px; font-size: 1.4rem; touch-action: none; }
        .t-in { width: 85px; }
        .p-in-top { flex-grow: 1; border: none !important; font-weight: bold; margin-left: 5px; font-size: 0.95rem; }
        .toggle-btn { color: var(--main); border: 1px solid var(--main); border-radius: 5px; padding: 4px 8px; font-size: 11px; white-space: nowrap; }

        .card-detail { display: none; padding: 12px; background: #fafafa; border-top: 1px solid #eee; }
        .card-detail.active { display: block; }

        .btn { border: none; border-radius: 10px; padding: 12px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-save { background: var(--main); color: white; margin-top: 10px; }
        .btn-add { background: var(--sub); color: white; margin-top: 15px; }
        .btn-add-cost { background: #eee; color: #666; font-size: 12px; padding: 6px; width: auto; margin: 5px 0; border-radius: 5px; }

        /* ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å±¥æ­´ */
        .hist-box { border-top: 1px dashed #ccc; margin-top: 20px; padding-top: 10px; }
        .hist-item { display: flex; justify-content: space-between; background: #e9ecef; padding: 8px; border-radius: 6px; margin-bottom: 5px; font-size: 11px; align-items: center; }
        .btn-restore { background: #666; color: white; padding: 3px 10px; border-radius: 4px; border: none; }
    </style>
</head>
<body>

<div class="box">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <span style="font-weight:bold">ğŸ’° æ—…ã®åˆè¨ˆ:</span>
        <span class="total-price"><span id="total-val">0</span> å††</span>
    </div>
    
    <div style="margin-top:10px; border-top: 1px solid #eee; padding-top:10px">
        <div style="font-size:12px; color:#666; margin-bottom:5px">â–¼ åˆæœŸè²»ç”¨ï¼ˆå®¿æ³Šãƒ»é«˜é€Ÿãƒ»ç‡ƒæ–™ãªã©ï¼‰</div>
        <div id="base-costs">
            <div class="cost-row"><input type="text" value="é«˜é€Ÿ(å°ç‰§-ä¸‹é–¢)"><input type="number" class="price-input" value="10290" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
            <div class="cost-row"><input type="text" value="ã‚¬ã‚½ãƒªãƒ³ä»£"><input type="number" class="price-input" value="8000" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
        </div>
        <button class="btn-add-cost" onclick="addCostRow('base-costs')">ï¼‹ é …ç›®ã‚’è¿½åŠ </button>
    </div>

    <button class="btn btn-save" onclick="saveAll()">ğŸ’¾ å¤‰æ›´ã‚’ä¿å­˜ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼‰</button>
</div>

<div id="main-list">
    <div class="day-label"><input type="date" value="2025-12-29" style="border:none; background:transparent; color:white; font-weight:bold"></div>
    
    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="01:30">
            <input class="p-in-top" value="å°ç‰§ å‡ºç™º">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div style="background:#eef3f9; padding:8px; border-radius:8px; font-size:12px; margin-bottom:10px">
                04:00ã¾ã§ã«é«˜é€Ÿé€šéã§æ·±å¤œå‰²å¼•ï¼
            </div>
            <div id="cost-1"></div>
            <button class="btn-add-cost" onclick="addCostRow(this)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
            <button class="btn" style="background:#eee; color:#999; font-size:11px; padding:5px; margin-top:10px" onclick="this.parentElement.parentElement.remove();calc()">ã“ã®é …ç›®ã‚’å‰Šé™¤</button>
        </div>
    </div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="03:30">
            <input class="p-in-top" value="ã€äº¬éƒ½ã€‘å¤§æ´¥SA">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div style="font-size:12px; margin-bottom:10px">çµç¶æ¹–ä¸€æœ›ãƒ‡ãƒƒã‚­ / äº¬é¢¨åœŸç”£</div>
            <div class="cost-row"><input type="text" value="ãŠåœŸç”£"><input type="number" class="price-input" value="1000" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
            <button class="btn-add-cost" onclick="addCostRow(this)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
        </div>
    </div>

    <div class="day-label"><input type="date" value="2025-12-30" style="border:none; background:transparent; color:white; font-weight:bold"></div>
    
    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="10:30">
            <input class="p-in-top" value="è§’å³¶å¤§æ©‹ è¦³å…‰">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div style="font-size:12px">çµ¶æ™¯ãƒ‰ãƒ©ã‚¤ãƒ–ï¼</div>
        </div>
    </div>
</div>

<button class="btn btn-add" onclick="addNewCard()">ï¼‹ äºˆå®šã‚’è¿½åŠ </button>

<div class="hist-box">
    <div style="font-weight:bold; font-size:12px; margin-bottom:8px">ğŸ•’ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å±¥æ­´ï¼ˆã“ã“ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰</div>
    <div id="hist-list"></div>
</div>

<script>
    // ä¸¦ã³æ›¿ãˆ (0.4sé•·æŠ¼ã—)
    Sortable.create(document.getElementById('main-list'), {
        handle: '.handle', animation: 150, delay: 400, delayOnTouchOnly: true
    });

    function toggleDetail(btn) {
        btn.parentElement.nextElementSibling.classList.toggle('active');
        btn.innerText = btn.innerText === 'è©³ç´°' ? 'é–‰ã˜ã‚‹' : 'è©³ç´°';
    }

    function calc() {
        let t = 0;
        document.querySelectorAll('.price-input').forEach(i => t += (parseInt(i.value) || 0));
        document.getElementById('total-val').innerText = t.toLocaleString();
    }

    function delRow(btn) { btn.parentElement.remove(); calc(); }

    function addCostRow(target) {
        const parent = typeof target === 'string' ? document.getElementById(target) : target.previousElementSibling;
        const div = document.createElement('div');
        div.className = 'cost-row';
        div.innerHTML = `<input type="text" placeholder="é …ç›®å"><input type="number" class="price-input" value="0" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button>`;
        parent.appendChild(div);
    }

    function addNewCard() {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="card-summary">
                <span class="handle">â˜°</span>
                <input type="time" class="t-in" value="12:00">
                <input class="p-in-top" placeholder="æ–°ã—ã„äºˆå®š">
                <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
            </div>
            <div class="card-detail">
                <div class="cost-area"></div>
                <button class="btn-add-cost" onclick="addCostRow(this.previousElementSibling)">ï¼‹ è²»ç”¨ã‚’è¿½åŠ </button>
                <button class="btn" style="background:#eee; color:#999; font-size:11px; padding:5px; margin-top:10px" onclick="this.parentElement.parentElement.remove();calc()">äºˆå®šã‚’å‰Šé™¤</button>
            </div>`;
        document.getElementById('main-list').appendChild(div);
    }

    function saveAll() {
        const data = {
            baseHtml: document.getElementById('base-costs').innerHTML,
            listHtml: document.getElementById('main-list').innerHTML,
            time: new Date().toLocaleString()
        };
        let h = JSON.parse(localStorage.getItem('trip_backup') || '[]');
        h.unshift(data);
        localStorage.setItem('trip_backup', JSON.stringify(h.slice(0, 5)));
        renderHist();
        alert('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã—ãŸï¼');
    }

    function renderHist() {
        const h = JSON.parse(localStorage.getItem('trip_backup') || '[]');
        document.getElementById('hist-list').innerHTML = h.map((d, i) => `
            <div class="hist-item">
                <span>ä¿å­˜: ${d.time}</span>
                <button class="btn-restore" onclick="restore(${i})">èª­ã¿å‡ºã™</button>
            </div>`).join('');
    }

    function restore(i) {
        const h = JSON.parse(localStorage.getItem('trip_backup') || '[]');
        document.getElementById('base-costs').innerHTML = h[i].baseHtml;
        document.getElementById('main-list').innerHTML = h[i].listHtml;
        calc();
        alert('æŒ‡å®šã—ãŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’èª­ã¿å‡ºã—ã¾ã—ãŸï¼');
    }

    window.onload = () => {
        const h = JSON.parse(localStorage.getItem('trip_backup') || '[]');
        if (h.length > 0) restore(0); else calc();
        renderHist();
    };
</script>
</body>
</html>
