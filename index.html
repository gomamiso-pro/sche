<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç‰§ã€œä¸‹é–¢ ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ—ãƒ©ãƒ³ã€ã‚«ã‚¹ã‚¿ãƒ ç‰ˆã€‘</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --main: #5d9cec; --sub: #48cfad; --warn: #fc6e51; --bg: #f0f2f5; }
        * { box-sizing: border-box; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); margin: 0; padding: 10px; color: #333; font-size: 14px; }
        
        .box { background: white; padding: 12px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px; }
        .total-price { color: var(--warn); font-size: 1.4rem; font-weight: bold; }

        input[type="text"], input[type="number"], input[type="time"], input[type="date"] {
            border: 1px solid #ddd; border-radius: 5px; padding: 6px; font-size: 14px; min-width: 0;
        }

        .cost-row { display: flex; gap: 4px; margin-bottom: 6px; align-items: center; width: 100%; }
        .cost-row input[type="text"] { flex: 2; }
        .cost-row input[type="number"] { flex: 1.2; text-align: right; }
        .row-del { color: white; background: #ccc; border: none; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        .day-label { background: var(--main); color: white; padding: 5px 12px; border-radius: 15px; display: inline-block; margin: 15px 0 10px 0; font-weight: bold; }
        
        .travel-time { font-size: 11px; color: #888; text-align: center; margin: 5px 0; border-left: 2px dashed #ddd; margin-left: 50px; padding-left: 10px; }

        .card { background: white; border-radius: 10px; margin-bottom: 8px; border-left: 5px solid var(--main); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .card-summary { display: flex; align-items: center; padding: 10px; gap: 5px; }
        .handle { color: #ddd; padding-right: 3px; font-size: 1.2rem; touch-action: none; cursor: grab; }
        .t-in { width: 80px; }
        .stay-in { width: 55px; color: var(--sub); font-weight: bold; text-align: center; border-color: var(--sub) !important; }
        .p-in-top { flex-grow: 1; border: none !important; font-weight: bold; font-size: 0.92rem; background: transparent; }
        .toggle-btn { color: var(--main); border: 1px solid var(--main); border-radius: 5px; padding: 4px 6px; font-size: 11px; white-space: nowrap; cursor: pointer; }

        .card-detail { display: none; padding: 12px; background: #fafafa; border-top: 1px solid #eee; }
        .card-detail.active { display: block; }

        .info-box { background: #eef3f9; padding: 8px; border-radius: 8px; font-size: 11px; margin-bottom: 10px; line-height: 1.4; }
        .map-btn { display: inline-flex; align-items: center; background: #4285F4; color: white; padding: 6px 10px; border-radius: 5px; text-decoration: none; font-size: 11px; font-weight: bold; gap: 4px; }

        .btn { border: none; border-radius: 10px; padding: 12px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-save { background: var(--main); color: white; margin-top: 10px; }
        .btn-add-spot { background: var(--sub); color: white; margin: 10px 0; font-size: 13px; padding: 8px; }
        .btn-add-cost { background: #eee; color: #666; font-size: 11px; padding: 4px 8px; width: auto; border-radius: 4px; display: inline-block; margin-top: 5px; }

        .hist-item { display: flex; justify-content: space-between; background: #e9ecef; padding: 8px; border-radius: 6px; margin-bottom: 5px; font-size: 11px; align-items: center; }
        .btn-restore { background: #666; color: white; padding: 3px 10px; border-radius: 4px; border: none; }
    </style>
</head>
<body>

<div class="box">
    <div style="display:flex; justify-content: space-between; align-items: center;">
        <span style="font-weight:bold">ğŸ’° æ—…ã®åˆè¨ˆ:</span>
        <span class="total-price"><span id="total-val">0</span> å††</span>
    </div>
    <div style="margin-top:8px; border-top: 1px solid #eee; padding-top:8px">
        <div id="base-costs">
            <div class="cost-row"><input type="text" value="é«˜é€Ÿ(æ·±å¤œå‰²é©ç”¨ç›®å®‰)"><input type="number" class="price-input" value="10290" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
            <div class="cost-row"><input type="text" value="ã‚¬ã‚½ãƒªãƒ³ä»£è¦‹è¾¼ã¿"><input type="number" class="price-input" value="8000" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
        </div>
        <button class="btn-add-cost" onclick="addCostRow('base-costs')">ï¼‹ å›ºå®šè²»ã‚’è¿½åŠ </button>
    </div>
    <button class="btn btn-save" onclick="saveAll()">ğŸ’¾ å¤‰æ›´ã‚’ä¿å­˜(ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—)</button>
</div>

<div id="main-list">
    <div class="day-label"><input type="date" value="2025-12-29" style="border:none; background:transparent; color:white; font-weight:bold"></div>
    
    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="01:30">
            <input class="p-in-top" value="å°ç‰§å¸‚ å‡ºç™º">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">04:00ã¾ã§ã«é«˜é€Ÿé“è·¯ã‚’é€šéã§æ·±å¤œå‰²å¼•é©ç”¨ï¼</div>
        </div>
    </div>

    <div class="travel-time">ğŸš— ç´„1.5æ™‚é–“</div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="03:00">
            æ»åœ¨ <input type="number" class="stay-in" value="30">åˆ†
            <input class="p-in-top" value="å¤§æ´¥SA (ä¸‹ã‚Š)">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ä½æ‰€ï¼šæ»‹è³€çœŒå¤§æ´¥å¸‚æœæ—¥ãŒä¸˜ï¼’ä¸ç›®ï¼˜âˆ’ï¼‘<br>é›»è©±ï¼š077-510-7350<br>â˜…çµç¶æ¹–ãŒè¦‹ãˆã‚‹å±•æœ›ãƒ‡ãƒƒã‚­ã‚ã‚Š</div>
            <a href="https://www.google.com/maps/search/?api=1&query=å¤§æ´¥SA(ä¸‹ã‚Š)" class="map-btn" target="_blank">ğŸ“ ãƒãƒƒãƒ—ã§è¦‹ã‚‹</a>
            <div class="cost-row"><input type="text" value="è»½é£Ÿ"><input type="number" class="price-input" value="1000" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
        </div>
    </div>

    <div class="travel-time">ğŸš— ç´„0.5æ™‚é–“</div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="04:00">
            æ»åœ¨ <input type="number" class="stay-in" value="20">åˆ†
            <input class="p-in-top" value="å¹ç”° SA (ä¸‹ã‚Š)">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ä½æ‰€ï¼šå¤§é˜ªåºœå¹ç”°å¸‚å²¸éƒ¨åŒ—ï¼”ä¸ç›®ï¼˜âˆ’ï¼‘<br>å¤§é˜ªåœŸç”£ã®å…ˆè¡Œãƒã‚§ãƒƒã‚¯ï¼</div>
            <a href="https://www.google.com/maps/search/?api=1&query=å¹ç”°SA(ä¸‹ã‚Š)" class="map-btn" target="_blank">ğŸ“ ãƒãƒƒãƒ—ã§è¦‹ã‚‹</a>
        </div>
    </div>

    <div class="travel-time">ğŸš— ç´„2.5æ™‚é–“</div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="07:30">
            æ»åœ¨ <input type="number" class="stay-in" value="40">åˆ†
            <input class="p-in-top" value="å‰å‚™SA (ä¸‹ã‚Š)">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ä½æ‰€ï¼šå²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºä»Šå²¡ï¼”ï¼—ï¼–<br>é›»è©±ï¼š086-284-8600<br>åç‰©ã€Œãˆã³ã‚ã—ã€ãŒäººæ°—ã€‚</div>
            <a href="https://www.google.com/maps/search/?api=1&query=å‰å‚™SA(ä¸‹ã‚Š)" class="map-btn" target="_blank">ğŸ“ ãƒãƒƒãƒ—ã§è¦‹ã‚‹</a>
        </div>
    </div>

    <div class="travel-time">ğŸš— ç´„2æ™‚é–“</div>

    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="10:30">
            æ»åœ¨ <input type="number" class="stay-in" value="120">åˆ†
            <input class="p-in-top" value="åŸçˆ†ãƒ‰ãƒ¼ãƒ  (æ˜¼é£Ÿè¾¼)">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ä½æ‰€ï¼šåºƒå³¶çœŒåºƒå³¶å¸‚ä¸­åŒºå¤§æ‰‹ç”ºï¼‘ä¸ç›®ï¼‘âˆ’ï¼‘ï¼<br>ä¸–ç•Œéºç”£ã€‚å‘¨è¾ºã§ãŠå¥½ã¿ç„¼ãã‚’ï¼</div>
            <a href="https://www.google.com/maps/search/?api=1&query=åŸçˆ†ãƒ‰ãƒ¼ãƒ " class="map-btn" target="_blank">ğŸ“ ãƒãƒƒãƒ—ã§è¦‹ã‚‹</a>
            <div class="cost-row"><input type="text" value="æ˜¼é£Ÿ"><input type="number" class="price-input" value="2500" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button></div>
        </div>
    </div>

    <button class="btn btn-add-spot" onclick="addNewSpot()">â• æ–°ã—ã„äºˆå®šã‚’è¿½åŠ </button>

    <div class="day-label"><input type="date" value="2025-12-30" style="border:none; background:transparent; color:white; font-weight:bold"></div>
    
    <div class="card">
        <div class="card-summary">
            <span class="handle">â˜°</span>
            <input type="time" class="t-in" value="09:00">
            æ»åœ¨ <input type="number" class="stay-in" value="60">åˆ†
            <input class="p-in-top" value="èµ¤é–“ç¥å®®">
            <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
        </div>
        <div class="card-detail">
            <div class="info-box">ä½æ‰€ï¼šå±±å£çœŒä¸‹é–¢å¸‚é˜¿å¼¥é™€å¯ºç”ºï¼”âˆ’ï¼‘<br>é®®ã‚„ã‹ãªç«œå®®é€ ã‚Šã®æ°´å¤©é–€ãŒæœ‰åã€‚</div>
            <a href="https://www.google.com/maps/search/?api=1&query=èµ¤é–“ç¥å®®" class="map-btn" target="_blank">ğŸ“ ãƒãƒƒãƒ—ã§è¦‹ã‚‹</a>
        </div>
    </div>
</div>

<div class="box" style="margin-top:20px; background:#f8f9fa">
    <div style="font-weight:bold; font-size:12px; margin-bottom:8px">ğŸ•’ ä¿å­˜å±¥æ­´</div>
    <div id="hist-list"></div>
</div>

<script>
    const mainList = document.getElementById('main-list');
    Sortable.create(mainList, { handle: '.handle', animation: 150 });

    function toggleDetail(btn) {
        const detail = btn.parentElement.nextElementSibling;
        detail.classList.toggle('active');
        btn.innerText = detail.classList.contains('active') ? 'é–‰ã˜ã‚‹' : 'è©³ç´°';
    }

    function calc() {
        let t = 0;
        document.querySelectorAll('.price-input').forEach(i => t += (parseInt(i.value) || 0));
        document.getElementById('total-val').innerText = t.toLocaleString();
    }

    function delRow(btn) { btn.parentElement.remove(); calc(); }

    function addCostRow(targetId) {
        const div = document.createElement('div');
        div.className = 'cost-row';
        div.innerHTML = `<input type="text" placeholder="é …ç›®å"><input type="number" class="price-input" value="0" oninput="calc()"><button class="row-del" onclick="delRow(this)">Ã—</button>`;
        document.getElementById(targetId).appendChild(div);
    }

    function addNewSpot() {
        const btnAdd = document.querySelector('.btn-add-spot');
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
            <div class="card-summary">
                <span class="handle">â˜°</span>
                <input type="time" class="t-in" value="12:00">
                æ»åœ¨ <input type="number" class="stay-in" value="30">åˆ†
                <input class="p-in-top" value="æ–°ã—ã„äºˆå®š">
                <span class="toggle-btn" onclick="toggleDetail(this)">è©³ç´°</span>
            </div>
            <div class="card-detail">
                <div class="info-box">ãƒ¡ãƒ¢ã‚’å…¥åŠ›...</div>
                <input type="text" placeholder="å ´æ‰€å" style="width:100%; margin-bottom:5px" onchange="updateMapLink(this)">
                <a href="#" class="map-btn" target="_blank">ğŸ“ ãƒãƒƒãƒ—ã§è¦‹ã‚‹</a>
                <button class="row-del" style="margin-top:10px" onclick="this.closest('.card').remove()">ã“ã®äºˆå®šã‚’å‰Šé™¤</button>
            </div>
        `;
        mainList.insertBefore(div, btnAdd);
    }

    function updateMapLink(input) {
        const link = input.nextElementSibling;
        link.href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(input.value)}`;
    }

    function saveAll() {
        const data = {
            baseHtml: document.getElementById('base-costs').innerHTML,
            listHtml: document.getElementById('main-list').innerHTML,
            time: new Date().toLocaleString()
        };
        let h = JSON.parse(localStorage.getItem('trip_v3_backup') || '[]');
        h.unshift(data);
        localStorage.setItem('trip_v3_backup', JSON.stringify(h.slice(0, 5)));
        renderHist();
        alert('ä¿å­˜ã—ã¾ã—ãŸï¼');
    }

    function renderHist() {
        const h = JSON.parse(localStorage.getItem('trip_v3_backup') || '[]');
        document.getElementById('hist-list').innerHTML = h.map((d, i) => `
            <div class="hist-item">
                <span>${d.time}</span>
                <button class="btn-restore" onclick="restore(${i})">å¾©å…ƒ</button>
            </div>`).join('');
    }

    function restore(i) {
        const h = JSON.parse(localStorage.getItem('trip_v3_backup') || '[]');
        document.getElementById('base-costs').innerHTML = h[i].baseHtml;
        document.getElementById('main-list').innerHTML = h[i].listHtml;
        calc();
    }

    window.onload = () => {
        const h = JSON.parse(localStorage.getItem('trip_v3_backup') || '[]');
        if (h.length > 0) restore(0); else calc();
        renderHist();
    };
</script>
</body>
</html>
